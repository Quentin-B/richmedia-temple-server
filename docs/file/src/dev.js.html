<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/dev.js | @mediamonks/richmedia-temple-server</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="This is the Richmedia Temple, used for creating richmedia units for various vendors."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@mediamonks/richmedia-temple-server"><meta property="twitter:description" content="This is the Richmedia Temple, used for creating richmedia units for various vendors."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/mediamonks/temple"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/dev.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">
const createConfigByRichmediarcList = require(&apos;./webpack/config/createConfigByRichmediarcList&apos;);
const devServer = require(&apos;./webpack/devServer&apos;);
const expandWithSpreadsheetData = require(&apos;./util/expandWithSpreadsheetData&apos;);

const saveChoicesInPackageJson = require(&quot;./util/saveChoicesInPackageJson&quot;);
const findJSONConfigs = require(&apos;./util/findRichmediaRC&apos;);
const inquirer = require(&apos;inquirer&apos;);
const chalk = require(&apos;chalk&apos;);

module.exports = async function dev({ glob = &apos;./**/.richmediarc*&apos;, choices = null, stats = null }) {
  // start with showing search message
  console.log(`${chalk.blue(&apos;i&apos;)} Searching for configs`);

  let configs = await findJSONConfigs(glob, [
    &apos;settings.entry.js&apos;,
    &apos;settings.entry.html&apos;,
  ]);

  if (configs.length === 0) {
    throw new Error(&apos;could not find a compatible .richmediarc with entry points configured&apos;);
  }

  console.log(`${chalk.green(&apos;&#x2714;&apos;)} Found ${configs.length} config(s)`);
  console.log(`${chalk.green(&apos;&#x2714;&apos;)} Taking a look if it has Spreadsheets`);

  configs = await expandWithSpreadsheetData(configs);

  if(!choices) {
    let answers = {
      location: &apos;all&apos;,
    };

    if (configs.length === 1) {
      console.log(`  Choosing ${configs[0].location}`);
      answers.location = configs[0].location;
    } else {
      answers = await inquirer.prompt([
        {
          type: &apos;checkbox&apos;,
          name: &apos;location&apos;,
          message: &apos;Please select config(s) build:&apos;,
          choices: [
            {name: &apos;all&apos;, checked: false},
            ...configs.map(config =&gt; {

              let name = config.location;

              if (config.data.name) {
                // name += ` (${config.data.name})`
              }

              return {
                name,
                checked: false
              };
            }),
          ],
          validate(answer) {
            if (answer.length &lt; 1) {
              return `${chalk.red(&apos;&#x2716; You must choose at least one.&apos;)} `;
            }
            return true;
          },
        },
      ]);
    }

    await saveChoicesInPackageJson(&apos;dev&apos;, {
      glob,
      choices: answers,
      stats,
    });

    choices = answers;
  }

  let configsResult = null;

  if (choices.location.indexOf(&apos;all&apos;) &gt; -1) {
    configsResult = configs;
  } else {
    configsResult = configs.filter(({location}) =&gt; {
      return choices.location.indexOf(location) &gt; -1;
    });
  }

  let list = await createConfigByRichmediarcList(configsResult, {
    mode: &apos;development&apos;,
    stats: false,
  });

  list = list.map((webpack, index) =&gt; {
    return {
      webpack,
      settings: configsResult[index]
    }
  });

  await devServer(list);
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
